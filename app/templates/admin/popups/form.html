{% extends 'layouts/admin.html' %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>{{ title }}</h2>
        <a href="{{ url_for('admin.popups') }}" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left"></i> Quay l·∫°i
        </a>
    </div>

    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-body">
                    <form method="POST" enctype="multipart/form-data">
                        {{ form.hidden_tag() }}

                        <!-- ·∫¢nh -->
                        <h5 class="mb-3">üñºÔ∏è ·∫¢nh Banner {% if not popup %}(B·∫Øt bu·ªôc){% endif %}</h5>

                        <div class="mb-3">
                            {{ form.image.label(class="form-label") }}
                            {{ form.image(class="form-control" + (" is-invalid" if form.image.errors else "")) }}
                            {% if form.image.errors %}
                                <div class="invalid-feedback">{{ form.image.errors[0] }}</div>
                            {% endif %}

                            {% if popup and popup.image %}
                                <div class="mt-3 p-3 bg-light rounded">
                                    <p class="mb-2"><strong>·∫¢nh hi·ªán t·∫°i:</strong></p>
                                    <img src="{{ popup.image }}" alt="Current" style="max-width: 100%; border-radius: 8px;">
                                    <p class="text-muted small mt-2 mb-0">
                                        üí° ƒê·ªÉ tr·ªëng n·∫øu kh√¥ng mu·ªën ƒë·ªïi ·∫£nh
                                    </p>
                                </div>
                            {% endif %}

                            <div class="alert alert-info mt-3">
                                <strong>üìå L∆∞u √Ω:</strong>
                                <ul class="mb-0">
                                    <li>Popup lu√¥n hi·ªÉn th·ªã <strong>gi·ªØa m√†n h√¨nh</strong></li>
                                    <li>Thi·∫øt k·∫ø t·∫•t c·∫£ n·ªôi dung (text, n√∫t CTA) trong ·∫£nh</li>
                                    <li>Khuy·∫øn ngh·ªã: 1200x800px ho·∫∑c 800x600px</li>
                                    <li>Dung l∆∞·ª£ng: d∆∞·ªõi 500KB ƒë·ªÉ load nhanh</li>
                                    <li>Format: PNG ho·∫∑c JPG</li>
                                </ul>
                            </div>
                        </div>

                        <hr class="my-4">

                        <!-- Link -->
                        <h5 class="mb-3">üîó Link chuy·ªÉn h∆∞·ªõng</h5>

                        <div class="mb-3">
                            {{ form.link.label(class="form-label") }}
                            {{ form.link(class="form-control") }}
                            <small class="text-muted">
                                Khi click v√†o ·∫£nh s·∫Ω chuy·ªÉn ƒë·∫øn link n√†y<br>
                                VD: /san-pham, /lien-he, tel:1900636294, https://zalo.me/...
                            </small>
                        </div>

                        <hr class="my-4">

                        <!-- Hi·ªÉn th·ªã -->
                        <h5 class="mb-3">üé® C√†i ƒë·∫∑t hi·ªÉn th·ªã</h5>

                        <div class="mb-3">
                            {{ form.display_pages.label(class="form-label") }}
                            {{ form.display_pages(class="form-select") }}
                        </div>

                        <div class="row">
                            <div class="col-md-8 mb-3">
                                {{ form.frequency.label(class="form-label") }}
                                {{ form.frequency(class="form-select") }}
                            </div>
                            <div class="col-md-4 mb-3">
                                {{ form.delay_seconds.label(class="form-label") }}
                                {{ form.delay_seconds(class="form-control") }}
                            </div>
                        </div>

                        <hr class="my-4">

                        <!-- Schedule -->
                        <h5 class="mb-3">üìÖ L√™n l·ªãch (T√πy ch·ªçn)</h5>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                {{ form.start_date.label(class="form-label") }}
                                {{ form.start_date(class="form-control") }}
                                <small class="text-muted">ƒê·ªÉ tr·ªëng = hi·ªÉn th·ªã ngay</small>
                            </div>
                            <div class="col-md-6 mb-3">
                                {{ form.end_date.label(class="form-label") }}
                                {{ form.end_date(class="form-control") }}
                                <small class="text-muted">ƒê·ªÉ tr·ªëng = kh√¥ng gi·ªõi h·∫°n</small>
                            </div>
                        </div>

                        <hr class="my-4">

                        <!-- Status -->
                        <div class="mb-3">
                            <div class="form-check form-switch">
                                {{ form.is_active(class="form-check-input") }}
                                {{ form.is_active.label(class="form-check-label") }}
                            </div>
                        </div>

                        <!-- Submit -->
                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> L∆∞u Popup
                            </button>
                            <a href="{{ url_for('admin.popups') }}" class="btn btn-outline-secondary">
                                H·ªßy
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Preview -->
        <div class="col-md-4">
            <div class="card sticky-top" style="top: 20px;">
                <div class="card-header">
                    <h5 class="mb-0">üëÅÔ∏è Preview (Center)</h5>
                </div>
                <div class="card-body">
                    <div id="popup-preview" class="border rounded p-2 text-center bg-dark">
                        <div id="preview-image">
                            {% if popup and popup.image %}
                                <img src="{{ popup.image }}" alt="Preview" class="img-fluid rounded" id="current-preview">
                            {% else %}
                                <div class="text-muted py-5">
                                    <i class="fas fa-image fa-3x"></i>
                                    <p class="mt-2">Ch∆∞a c√≥ ·∫£nh</p>
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="mt-3">
                        <h6>üí° G·ª£i √Ω thi·∫øt k·∫ø:</h6>
                        <ul class="small">
                            <li>Popup lu√¥n ·ªü gi·ªØa m√†n h√¨nh</li>
                            <li>S·ª≠ d·ª•ng Canva/Photoshop</li>
                            <li>N·ªôi dung r√µ r√†ng, d·ªÖ ƒë·ªçc</li>
                            <li>N√∫t CTA n·ªïi b·∫≠t</li>
                            <li>Test tr√™n mobile & desktop</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Live preview
document.addEventListener('DOMContentLoaded', function() {
    const imageInput = document.querySelector('[name="image"]');

    if (imageInput) {
        imageInput.addEventListener('change', function() {
            if (this.files && this.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('preview-image').innerHTML =
                        `<img src="${e.target.result}" class="img-fluid rounded" alt="Preview" id="current-preview">`;
                };
                reader.readAsDataURL(this.files[0]);
            }
        });
    }
});
</script>
{% endblock %}
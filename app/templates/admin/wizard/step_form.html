{% extends 'layouts/admin.html' %}

{% block page_title %}{{ title }}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1 class="h3 mb-1">{{ title }}</h1>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item"><a href="{{ url_for('admin.dashboard') }}">Dashboard</a></li>
                <li class="breadcrumb-item"><a href="{{ url_for('admin.wizards') }}">Wizards</a></li>
                <li class="breadcrumb-item"><a href="{{ url_for('admin.wizard_steps', wizard_id=wizard.id) }}">{{ wizard.name }}</a></li>
                <li class="breadcrumb-item active">{{ title }}</li>
            </ol>
        </nav>
    </div>
    <a href="{{ url_for('admin.wizard_steps', wizard_id=wizard.id) }}" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left me-1"></i> Quay lại
    </a>
</div>

<div class="row">
    <div class="col-lg-8">
        <div class="card shadow-sm">
            <div class="card-body p-4">
                <form method="POST" action="">
                    {{ form.hidden_tag() }}

                    <!-- Step Number -->
                    <div class="mb-3">
                        {{ form.step_number.label(class="form-label fw-bold") }}
                        {{ form.step_number(class="form-control" ~ (" is-invalid" if form.step_number.errors else ""), type="number", min="1") }}
                        {% if form.step_number.errors %}
                        <div class="invalid-feedback">
                            {% for error in form.step_number.errors %}{{ error }}{% endfor %}
                        </div>
                        {% endif %}
                        <small class="form-text text-muted">Số thứ tự của bước này trong wizard (1, 2, 3...)</small>
                    </div>

                    <!-- Question Text -->
                    <div class="mb-3">
                        {{ form.question_text.label(class="form-label fw-bold") }}
                        {{ form.question_text(class="form-control" ~ (" is-invalid" if form.question_text.errors else "")) }}
                        {% if form.question_text.errors %}
                        <div class="invalid-feedback">
                            {% for error in form.question_text.errors %}{{ error }}{% endfor %}
                        </div>
                        {% endif %}
                        <small class="form-text text-muted">Câu hỏi hiển thị cho user</small>
                    </div>

                    <!-- Description -->
                    <div class="mb-3">
                        {{ form.description.label(class="form-label fw-bold") }}
                        {{ form.description(class="form-control") }}
                        <small class="form-text text-muted">Mô tả thêm, giải thích câu hỏi (optional)</small>
                    </div>

                    <!-- Step Type -->
                    <div class="mb-3">
                        {{ form.step_type.label(class="form-label fw-bold") }}
                        {{ form.step_type(class="form-select") }}
                        <small class="form-text text-muted">
                            <strong>Chọn một đáp án:</strong> Radio buttons (chỉ chọn 1)<br>
                            <strong>Chọn nhiều đáp án:</strong> Checkboxes (chọn được nhiều)
                        </small>
                    </div>

                    <!-- Is Required -->
                    <div class="mb-4">
                        <div class="form-check form-switch">
                            {{ form.is_required(class="form-check-input") }}
                            {{ form.is_required.label(class="form-check-label fw-bold") }}
                        </div>
                        <small class="form-text text-muted">Bắt buộc phải trả lời mới được chuyển bước</small>
                    </div>

                    <!-- Submit -->
                    <div class="d-flex justify-content-between">
                        <a href="{{ url_for('admin.wizard_steps', wizard_id=wizard.id) }}" class="btn btn-outline-secondary">
                            <i class="bi bi-x-circle me-1"></i> Hủy
                        </a>
                        {{ form.submit(class="btn btn-warning") }}
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="col-lg-4">
        <div class="card shadow-sm bg-light">
            <div class="card-body">
                <h6 class="fw-bold mb-3">
                    <i class="bi bi-lightbulb text-warning me-2"></i>
                    Tips
                </h6>
                <ul class="small mb-0 ps-3">
                    <li class="mb-2">Đặt câu hỏi rõ ràng, dễ hiểu</li>
                    <li class="mb-2">Dùng "single choice" cho câu hỏi có 1 đáp án đúng</li>
                    <li class="mb-2">Dùng "multiple choice" khi user có thể chọn nhiều</li>
                    <li>Thêm description để giải thích thêm nếu cần</li>
                </ul>
            </div>
        </div>

        {% if step %}
        <div class="card shadow-sm mt-3">
            <div class="card-header bg-warning text-dark fw-bold">
                <i class="bi bi-list-check me-2"></i>
                Options hiện tại
            </div>
            <div class="card-body">
                {% if step.total_options > 0 %}
                <p class="mb-2">Step này có <strong>{{ step.total_options }} options</strong></p>
                <a href="{{ url_for('admin.step_options', step_id=step.id) }}" class="btn btn-outline-primary btn-sm">
                    <i class="bi bi-gear me-1"></i> Quản lý Options
                </a>
                {% else %}
                <p class="text-muted mb-2">Chưa có option nào</p>
                <a href="{{ url_for('admin.add_option', step_id=step.id) }}" class="btn btn-primary btn-sm">
                    <i class="bi bi-plus-circle me-1"></i> Thêm Option
                </a>
                {% endif %}
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
{% extends 'layouts/base.html' %}

{% block title %}Kết quả - {{ wizard.name }}{% endblock %}

{% block content %}
<section class="br-gridres py-5">
  <div class="container">
    <div class="br-gridres-wrap mx-auto">

      <!-- Header (gọn) -->
      <div class="br-top mb-4">
        <div>
          <div class="br-kicker">
            <span class="br-pill"><i class="bi bi-check2-circle"></i> Kết quả</span>
            <span class="br-muted">• {{ wizard.name }}</span>
          </div>
          <h1 class="br-title">
            Có <span class="br-mark">{{ recommended_products|length }}</span> sản phẩm phù hợp
          </h1>
          <p class="br-sub">Chạm vào sản phẩm để xem chi tiết.</p>
        </div>
      </div>

      {% if recommended_products %}
        <!-- GRID (small cards) -->
        <div class="br-grid">
          {% for item in recommended_products %}
            <a class="br-card" href="{{ url_for('main.product_detail', slug=item.product.slug) }}">
              <div class="br-img">
                <img
                  src="{{ item.product.image or url_for('static', filename='img/logo.png') }}"
                  alt="{{ item.product.name }}"
                  loading="lazy"
                >
              </div>

              <div class="br-body">
                <div class="br-row">
                  {% if item.product.category %}
                    <span class="br-cat">
                      <i class="bi bi-tag"></i>
                      {{ item.product.category.name }}
                    </span>
                  {% else %}
                    <span></span>
                  {% endif %}
                </div>

                <div class="br-name">{{ item.product.name }}</div>

                {# Lý do: nếu muốn bỏ luôn cho siêu gọn => xóa block này #}
                {% if item.reasons %}
                  <div class="br-reason">
                    {{ item.reasons[0] }}
                  </div>
                {% endif %}
              </div>
            </a>
          {% endfor %}
        </div>
      {% else %}
        <div class="br-empty">
          <div class="br-empty-ic"><i class="bi bi-inbox"></i></div>
          <h2 class="br-empty-title">Chưa tìm thấy sản phẩm phù hợp</h2>
        </div>
      {% endif %}

    </div>
  </div>
</section>

<style>
  :root{
    --br-yellow:#FFC107;
    --br-ink:#0b0f1a;
    --br-text:#111827;
    --br-muted:#6b7280;
    --br-border:rgba(17,24,39,.10);
    --br-bg:#f7f8fb;
    --br-card:#ffffff;
    --br-shadow: 0 10px 28px rgba(11,15,26,.08);
    --br-radius: 18px;
  }

  .br-gridres{
    background:
      radial-gradient(900px 320px at 20% 0%, rgba(255,193,7,.08), transparent 60%),
      linear-gradient(180deg, #ffffff, var(--br-bg));
    min-height: 75vh;
  }
  .br-gridres-wrap{ max-width: 1120px; }

  /* Header */
  .br-top{
    display:flex;
    justify-content:space-between;
    gap: 14px;
    padding: 16px;
    border: 1px solid var(--br-border);
    border-radius: var(--br-radius);
    background: rgba(255,255,255,.78);
    box-shadow: 0 8px 22px rgba(11,15,26,.06);
    backdrop-filter: blur(6px);
  }
  .br-kicker{ display:flex; align-items:center; gap:10px; font-size: 13.5px; }
  .br-pill{
    display:inline-flex; align-items:center; gap:8px;
    padding: 6px 10px;
    border-radius: 999px;
    border: 1px solid rgba(255,193,7,.30);
    background: rgba(255,193,7,.12);
    color: var(--br-ink);
    font-weight: 900;
  }
  .br-title{
    margin: 8px 0 6px;
    font-size: clamp(20px, 2.2vw, 30px);
    font-weight: 950;
    letter-spacing: -0.02em;
    color: var(--br-text);
  }
  .br-mark{
    padding: 2px 10px;
    border-radius: 999px;
    background: rgba(255,193,7,.20);
    border: 1px solid rgba(255,193,7,.35);
  }
  .br-sub{ margin: 0; color: var(--br-muted); font-size: 14.5px; max-width: 680px; }
  .br-muted{ color: var(--br-muted); }

  /* Buttons */
  .br-btn{
    display:inline-flex; align-items:center; justify-content:center; gap:10px;
    padding: 10px 12px;
    border-radius: 14px;
    font-weight: 950;
    text-decoration:none;
    border: 1px solid rgba(17,24,39,.12);
    transition: transform .12s ease, box-shadow .12s ease, filter .12s ease;
    white-space: nowrap;
  }
  .br-btn i{ font-size: 18px; line-height: 1; }
  .br-btn-primary{
    background: var(--br-yellow);
    color: var(--br-ink);
    border-color: rgba(11,15,26,.10);
    box-shadow: 0 10px 18px rgba(255,193,7,.20);
  }
  .br-btn-primary:hover{ transform: translateY(-1px); filter: brightness(.985); }
  .br-btn-ghost{ background:#fff; color: var(--br-text); }
  .br-btn-ghost:hover{ transform: translateY(-1px); box-shadow: 0 10px 22px rgba(11,15,26,.06); }

  /* GRID: card nhỏ hơn */
  .br-grid{
    margin-top: 16px;
    display:grid;
    grid-template-columns: repeat(4, minmax(0, 1fr));
    gap: 12px;
  }

  /* Clickable card */
  .br-card{
    display:flex;
    flex-direction: column;
    border: 1px solid var(--br-border);
    border-radius: 16px;
    background: var(--br-card);
    overflow:hidden;
    text-decoration:none;
    color: inherit;
    box-shadow: 0 8px 18px rgba(11,15,26,.06);
    transition: transform .12s ease, box-shadow .12s ease, border-color .12s ease;
  }
  .br-card:hover{
    transform: translateY(-1px);
    box-shadow: 0 14px 28px rgba(11,15,26,.10);
    border-color: rgba(255,193,7,.28);
  }
  .br-card:focus{
    outline: none;
    box-shadow: 0 0 0 4px rgba(255,193,7,.20), 0 14px 28px rgba(11,15,26,.10);
  }

  /* Image nhỏ gọn */
  .br-img{
    background: rgba(17,24,39,.02);
    border-bottom: 1px solid rgba(17,24,39,.08);
  }
  .br-img img{
    width:100%;
    aspect-ratio: 1 / 1; /* vuông cho gọn */
    object-fit: cover;
    display:block;
  }

  .br-body{
    padding: 10px 10px 12px;
    display:flex;
    flex-direction: column;
    gap: 8px;
  }

  .br-row{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap: 8px;
  }

  .br-cat{
    display:inline-flex;
    align-items:center;
    gap: 6px;
    font-size: 12.5px;
    font-weight: 900;
    color: var(--br-muted);

    max-width: 72%;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  .br-cat i{ color: var(--br-yellow); }


  /* Clamp tên sản phẩm tránh dài như ảnh bạn gửi */
  .br-name{
    font-size: 14px;
    font-weight: 950;
    color: var(--br-text);
    line-height: 1.25;

    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;

    min-height: calc(1.25em * 2);
  }

  /* Reason 1 dòng, nếu bạn muốn bỏ luôn => xóa block HTML */
  .br-reason{
    font-size: 13px;
    color: var(--br-muted);
    overflow:hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  /* Empty */
  .br-empty{
    margin-top: 16px;
    background: #fff;
    border: 1px solid var(--br-border);
    border-radius: var(--br-radius);
    box-shadow: var(--br-shadow);
    padding: 34px 18px;
    text-align:center;
  }
  .br-empty-ic{
    width: 56px; height: 56px;
    margin: 0 auto 12px;
    border-radius: 16px;
    display:flex; align-items:center; justify-content:center;
    background: rgba(17,24,39,.04);
    border: 1px solid rgba(17,24,39,.08);
    color: var(--br-muted);
  }
  .br-empty-ic i{ font-size: 26px; }
  .br-empty-title{
    font-size: 18px;
    font-weight: 950;
    color: var(--br-text);
    margin: 0 0 6px;
  }

  /* Responsive */
  @media (max-width: 1200px){
    .br-grid{ grid-template-columns: repeat(3, minmax(0,1fr)); }
  }
  @media (max-width: 992px){
    .br-top{ flex-direction: column; }
    .br-grid{ grid-template-columns: repeat(2, minmax(0,1fr)); }
  }
  @media (max-width: 576px){
    .br-grid{ grid-template-columns: 1fr; }
    .br-img img{ aspect-ratio: 16/10; } /* mobile nhìn đẹp hơn vuông */
  }
</style>
{% endblock %}

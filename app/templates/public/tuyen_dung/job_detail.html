{% extends 'layouts/base.html' %}

{% block title %}{{ job.title }} - Tuyển dụng - {{ get_setting('website_name', '') }}{% endblock %}
{% block meta_description %}{{ job.title }} - {{ get_setting('website_name', '') }}. {{ job.location }}. Mức lương: {{ job.salary }}. Ứng tuyển ngay!{% endblock %}

{% block content %}
<!-- ==================== BREADCRUMB & PAGE HEADER ==================== -->
<div class="page-header bg-light py-4">
    <div class="container">
        <h1 class="fw-bold mb-3">{{ job.title }}</h1>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item"><a href="{{ url_for('main.index') }}">Trang chủ</a></li>
                <li class="breadcrumb-item"><a href="{{ url_for('main.careers') }}">Tuyển dụng</a></li>
                <li class="breadcrumb-item active" aria-current="page">
                    {{ job.title[:50] }}{% if job.title|length > 50 %}...{% endif %}
                </li>
            </ol>
        </nav>
    </div>
</div>
<!-- Job Detail -->
<section class="job-detail py-5" itemscope itemtype="https://schema.org/JobPosting">
    <div class="container">
        <div class="row">
            <div class="col-lg-8">
                <!-- Job Header -->
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div>
                                <h2 class="h3 mb-2" itemprop="title">{{ job.title }}</h2>
                                {% if job.is_urgent %}
                                <span class="badge bg-danger mb-2">
                                    <i class="bi bi-lightning-fill"></i> Tuyển gấp
                                </span>
                                {% endif %}
                                <meta itemprop="datePosted"
                                      content="{{ job.created_at|vn_datetime('%Y-%m-%d') if job.created_at else '' }}">
                                {% if job.deadline %}
                                <meta itemprop="validThrough" content="{{ job.deadline|vn_datetime('%Y-%m-%d') }}">
                                {% endif %}
                            </div>
                            {% if not job.is_expired() %}
                            <span class="badge bg-success">Đang tuyển</span>
                            {% else %}
                            <span class="badge bg-secondary">Đã đóng</span>
                            {% endif %}
                        </div>

                        <div class="row g-3 mb-4">
                            {% if job.department %}
                            <div class="col-md-6">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-briefcase text-warning fs-4 me-3"></i>
                                    <div>
                                        <small class="text-muted d-block">Phòng ban</small>
                                        <strong>{{ job.department }}</strong>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                            <div class="col-md-6" itemprop="jobLocation" itemscope itemtype="https://schema.org/Place">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-geo-alt text-warning fs-4 me-3"></i>
                                    <div>
                                        <small class="text-muted d-block">Địa điểm</small>
                                        <strong itemprop="address" itemscope
                                                itemtype="https://schema.org/PostalAddress">
                                            <span itemprop="addressLocality">{{ job.location }}</span>
                                            <meta itemprop="addressCountry" content="VN">
                                        </strong>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-clock text-warning fs-4 me-3"></i>
                                    <div>
                                        <small class="text-muted d-block">Hình thức</small>
                                        <strong itemprop="employmentType">{{ job.job_type }}</strong>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-bar-chart text-warning fs-4 me-3"></i>
                                    <div>
                                        <small class="text-muted d-block">Cấp bậc</small>
                                        <strong>{{ job.level }}</strong>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6" itemprop="baseSalary" itemscope
                                 itemtype="https://schema.org/MonetaryAmount">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-cash-stack text-warning fs-4 me-3"></i>
                                    <div>
                                        <small class="text-muted d-block">Mức lương</small>
                                        <strong class="text-success">
                                            <span itemprop="value">{{ job.salary }}</span>
                                        </strong>
                                        <meta itemprop="currency" content="VND">
                                    </div>
                                </div>
                            </div>
                            {% if job.experience %}
                            <div class="col-md-6">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-award text-warning fs-4 me-3"></i>
                                    <div>
                                        <small class="text-muted d-block">Kinh nghiệm</small>
                                        <strong itemprop="experienceRequirements">{{ job.experience }}</strong>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                        </div>

                        {% if job.deadline and not job.is_expired() %}
                        <div class="alert alert-warning">
                            <i class="bi bi-calendar-event"></i>
                            <strong>Hạn nộp hồ sơ:</strong> {{ job.deadline|vn_date }}
                        </div>
                        {% endif %}

                        <!-- Hidden Schema.org Organization -->
                        <div itemprop="hiringOrganization" itemscope itemtype="https://schema.org/Organization"
                             style="display:none;">
                            <span itemprop="name">{{ get_setting('website_name', '') }}</span>
                            <link itemprop="url" href="{{ get_setting('main_url', request.url_root) }}">
                            <link itemprop="logo"
                                  href="{{ get_setting('logo_url', url_for('static', filename='img/logo.png', _external=True)) }}">
                        </div>
                    </div>
                </div>

                <!-- Job Description -->
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-body">
                        <h5 class="card-title mb-3">
                            <i class="bi bi-file-text"></i> Mô tả công việc
                        </h5>
                        <div class="job-description" itemprop="description">
                            {{ job.description|safe }}
                        </div>
                    </div>
                </div>

                <!-- Requirements -->
                {% if job.requirements %}
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-body">
                        <h5 class="card-title mb-3">
                            <i class="bi bi-check2-square"></i> Yêu cầu ứng viên
                        </h5>
                        <div class="requirements" itemprop="qualifications">
                            {{ job.requirements|safe }}
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Benefits -->
                {% if job.benefits %}
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-body">
                        <h5 class="card-title mb-3">
                            <i class="bi bi-gift"></i> Quyền lợi
                        </h5>
                        <div class="benefits" itemprop="jobBenefits">
                            {{ job.benefits|safe }}
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Apply CTA -->
                {% if not job.is_expired() %}
                <div class="card border-0 shadow-sm bg-warning">
                    <div class="card-body text-center py-4">
                        <h4 class="mb-3">Bạn quan tâm đến vị trí này?</h4>
                        <p class="mb-4">Hãy gửi CV của bạn cho chúng tôi ngay hôm nay!</p>
                        <a href="mailto:{{ job.contact_email or get_setting('contact_email', 'info@hoang.vn') }}?subject=Ứng tuyển {{ job.title }}"
                           class="btn btn-dark btn-lg">
                            <i class="bi bi-envelope"></i> Gửi CV ngay
                        </a>
                        <p class="small text-muted mt-3 mb-0">
                            Email: {{ job.contact_email or get_setting('contact_email', 'info@hoang.vn') }}
                        </p>
                    </div>
                </div>
                {% else %}
                <div class="alert alert-secondary text-center">
                    <i class="bi bi-info-circle"></i> Vị trí này đã hết hạn nộp hồ sơ
                </div>
                {% endif %}
            </div>

            <!-- Sidebar -->
            <div class="col-lg-4">
                <div class="sidebar-wrapper">
                    <!-- Quick Apply -->
                    {% if not job.is_expired() %}
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-header bg-warning">
                            <h5 class="mb-0"><i class="bi bi-send"></i> Ứng tuyển nhanh</h5>
                        </div>
                        <div class="card-body">
                            <form action="mailto:{{ job.contact_email or get_setting('contact_email', 'info@hoang.vn') }}"
                                  method="get" enctype="text/plain">
                                <input type="hidden" name="subject" value="Ứng tuyển {{ job.title }}">

                                <div class="mb-3">
                                    <label class="form-label">Họ tên *</label>
                                    <input type="text" class="form-control" required>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Email *</label>
                                    <input type="email" class="form-control" required>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Số điện thoại *</label>
                                    <input type="tel" class="form-control" required>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">CV đính kèm</label>
                                    <input type="file" class="form-control" accept=".pdf,.doc,.docx">
                                    <small class="text-muted">PDF, DOC, DOCX (Max 5MB)</small>
                                </div>

                                <button type="submit" class="btn btn-warning w-100">
                                    <i class="bi bi-send"></i> Gửi hồ sơ
                                </button>
                            </form>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Contact Info -->
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-header bg-light">
                            <h6 class="mb-0"><i class="bi bi-info-circle"></i> Liên hệ</h6>
                        </div>
                        <div class="card-body">
                            <p class="mb-2 text-center">
                                <i class="bi bi-telephone text-warning"></i>
                                <strong>Hotline:</strong>
                                <a href="tel:{{ get_setting('hotline', '')|replace('.', '')|replace(' ', '') }}"
                                   class="text-decoration-none text-primary fw-bold">
                                    {{ get_setting('hotline', '') }}
                                </a>
                            </p>
                            <p class="mb-2 text-center">
                                <i class="bi bi-envelope text-warning"></i>
                                <strong>Email:</strong>
                                <a href="mailto:{{ get_setting('contact_email', 'info@hoang.vn') }}"
                                   class="text-decoration-none text-primary fw-bold">
                                    {{ get_setting('contact_email', 'info@hoang.vn') }}
                                </a>
                            </p>
                            <p class="mb-0 text-center">
                                <i class="bi bi-geo-alt text-warning"></i>
                                <strong>Địa chỉ:</strong>
                                {{ get_setting('address', '982/l98/a1 Tân Bình, Tân Phú Nhà Bè') }}
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- ==================== SCHEMA.ORG - BREADCRUMB ==================== -->
<script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
            {
                "@type": "ListItem",
                "position": 1,
                "name": "Trang chủ",
                "item": "{{ url_for('main.index', _external=True) }}"
            },
            {
                "@type": "ListItem",
                "position": 2,
                "name": "Tuyển dụng",
                "item": "{{ url_for('main.careers', _external=True) }}"
            },
            {
                "@type": "ListItem",
                "position": 3,
                "name": "{{ job.title|e }}",
                "item": "{{ url_for('main.job_detail', slug=job.slug, _external=True) }}"
            }
        ]
    }
</script>
{% endblock %}

{% block extra_css %}
<style>
    /* ==================== LIST BULLET ICONS ==================== */
    .job-description ul,
    .requirements ul,
    .benefits ul {
        list-style: none;
        padding-left: 0;
    }

    .job-description ul li,
    .requirements ul li,
    .benefits ul li {
        padding-left: 1.5em;
        position: relative;
        margin-bottom: 0.5rem;
    }

    .job-description ul li:before,
    .requirements ul li:before,
    .benefits ul li:before {
        content: "\F26B";
        font-family: "bootstrap-icons";
        color: #ffc107;
        position: absolute;
        left: 0;
    }

    /* ==================== CKEDITOR IMAGE STYLES ==================== */
    .job-description img,
    .requirements img,
    .benefits img {
        max-width: 100%;
        height: auto;
        display: block;
        margin: 1rem 0;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .job-description figure.image,
    .requirements figure.image,
    .benefits figure.image {
        margin: 1.5rem 0;
        display: block;
    }

    .job-description figure.image img,
    .requirements figure.image img,
    .benefits figure.image img {
        margin: 0;
    }

    /* Image alignment */
    .job-description .image-style-align-left,
    .requirements .image-style-align-left,
    .benefits .image-style-align-left {
        float: left;
        margin-right: 1.5rem;
        max-width: 50%;
    }

    .job-description .image-style-align-right,
    .requirements .image-style-align-right,
    .benefits .image-style-align-right {
        float: right;
        margin-left: 1.5rem;
        max-width: 50%;
    }

    .job-description .image-style-align-center,
    .requirements .image-style-align-center,
    .benefits .image-style-align-center {
        margin-left: auto;
        margin-right: auto;
        text-align: center;
    }

    .job-description figcaption,
    .requirements figcaption,
    .benefits figcaption {
        text-align: center;
        font-size: 0.875rem;
        color: #6c757d;
        margin-top: 0.5rem;
        font-style: italic;
    }

    .job-description::after,
    .requirements::after,
    .benefits::after {
        content: "";
        display: table;
        clear: both;
    }

    /* ==================== CKEDITOR TABLE STYLES ==================== */
    .job-description table,
    .requirements table,
    .benefits table {
        width: 100%;
        margin: 1.5rem 0;
        border-collapse: collapse;
        border: 1px solid #dee2e6;
    }

    .job-description table th,
    .requirements table th,
    .benefits table th {
        background-color: #FFC107;
        color: #000;
        font-weight: 600;
        padding: 0.75rem;
        border: 1px solid #dee2e6;
    }

    .job-description table td,
    .requirements table td,
    .benefits table td {
        padding: 0.75rem;
        border: 1px solid #dee2e6;
    }

    .job-description table tr:nth-child(even),
    .requirements table tr:nth-child(even),
    .benefits table tr:nth-child(even) {
        background-color: #f8f9fa;
    }

    /* ==================== RESPONSIVE ==================== */
    @media (max-width: 768px) {
        .job-description .image-style-align-left,
        .requirements .image-style-align-left,
        .benefits .image-style-align-left,
        .job-description .image-style-align-right,
        .requirements .image-style-align-right,
        .benefits .image-style-align-right {
            float: none;
            margin: 1rem 0;
            max-width: 100%;
        }
    }

    /* ==================== SIDEBAR STICKY ==================== */
    .sidebar-wrapper {
        position: sticky;
        top: 120px;
        max-height: calc(100vh - 110px);
        overflow-y: auto;
        padding-bottom: 20px;
    }

    .sidebar-wrapper::-webkit-scrollbar {
        display: none;
    }

    .sidebar-wrapper {
        -ms-overflow-style: none;
        scrollbar-width: none;
    }

    @media (max-width: 991.98px) {
        .sidebar-wrapper {
            position: static;
            max-height: none;
            overflow-y: visible;
        }
    }

    /* ==================== LINK HOVER ==================== */
    a.text-primary.fw-bold:hover {
        color: #004085 !important;
        text-decoration: underline;
        transition: 0.2s ease;
    }
</style>
{% endblock %}

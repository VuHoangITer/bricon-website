<div class="col-lg-4 col-md-4 col-sm-6 col-6">
  <div class="card product-card h-100 border-0 shadow-sm">
    <a
      href="{{ url_for('main.product_detail', slug=product.slug) }}"
      class="stretched-link"
    ></a>
    <!-- Product Image -->
    <div class="product-image position-relative">
      {% set media_info = product.get_media_seo_info() if product.image else
      None %}

      <!-- Link bọc ảnh -->
      <a
        href="{{ url_for('main.product_detail', slug=product.slug) }}"
        class="d-block"
      >
        <img
          src="{{ product.image if product.image else 'https://via.placeholder.com/300x300/FFC107/FFFFFF?text=Product' }}"
          class="card-img-top"
          alt="{{ media_info.alt_text if media_info and media_info.alt_text else product.name }}"
          title="{{ media_info.title if media_info and media_info.title else product.name }}"
          loading="lazy"
        />
      </a>

      <!-- Hover Icons -->
      <div class="hover-icons">
        <!-- Icon phóng to → mở lightbox -->
        <a
          href="javascript:void(0)"
          class="hover-icon lightbox-trigger"
          title="Phóng to"
          data-image="{{ product.image if product.image else 'https://via.placeholder.com/800x800/FFC107/FFFFFF?text=Product' }}"
          data-title="{{ product.name }}"
        >
          <i class="bi bi-eye-fill"></i>
        </a>
      </div>

      <!-- Caption ẩn cho SEO -->
      {% if media_info and media_info.caption %}
      <div class="visually-hidden">{{ media_info.caption }}</div>
      {% endif %}

      <!-- Badge giảm giá -->
      {% if product.old_price and product.price > 0 %}
      <span class="badge bg-danger">
        -{{ ((product.old_price - product.price) / product.old_price * 100)|int
        }}%
      </span>
      {% endif %}
    </div>

    <!-- Product Info -->
    <div class="card-body d-flex flex-column text-center">
      <h5 class="product-name mb-2">
        <a
          href="{{ url_for('main.product_detail', slug=product.slug) }}"
          class="text-decoration-none text-dark"
        >
          {{ product.name }}
        </a>
      </h5>

      <div class="product-price">
        {% if product.price == 0 %}
        <span class="price text-danger fw-bold">Liên hệ</span>
        {% else %}
        <span class="price d-block fw-semibold"
          >{{ product.price|format_price }}đ</span
        >
        {% if product.old_price %}
        <span class="old-price text-muted text-decoration-line-through">
          {{ product.old_price|format_price }}đ
        </span>
        {% endif %} {% endif %}
      </div>
    </div>
  </div>
</div>
